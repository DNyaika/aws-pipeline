version: 0.2

phases:
  install:
    commands:
      - echo "Installing Node.js"
      - curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.5/install.sh | bash
      - . ~/.nvm/nvm.sh
      - nvm install 18.17.0  # or any compatible version
      - nvm use 18.17.0
      - npm install -g npm@10  # Install npm after upgrading Node.js
      - echo "Installing project dependencies"
      - npm install
  build:
    commands:
      - echo "Running build"
      - npm run build
      - echo "Running CDK synth"
      - npm run cdk -- synth
artifacts:
  base-directory: cdk.out
  files:
    - '**/*'